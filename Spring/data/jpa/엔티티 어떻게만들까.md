λ°μ΄ν„°λ¥Ό `CRUD` ν•λ” κΈ°λ³Έμ μΈ κ°λ…μΈ `Entitiy`μ— λ€ν•΄μ„ ν•™μµμ„ μ§„ν–‰ν•λ‹¤. 

<br />

### π€ ν•™μµ λ©ν‘
- `Entity` μ— λ€ν•΄μ„ ν•™μµν•λ‹¤.
  - `BaseEntity` κ°€ λ¬΄μ—‡μΈμ§€ μ¤μ¤λ΅ ν•™μµν•λ©°, μ‚¬μ©ν•λ” λ°©λ²•μ— λ€ν•΄μ„ μµνλ‹¤.
  - λ„λ©”μΈ κ°μ²΄λ¥Ό μ‹λ³„ν•΄λ³΄λ” μ—°μµμ„ ν•λ‹¤.
  - λ„λ©”μΈ κ°μ²΄λ¥Ό κµ¬ν„, ν…μ¤νΈ μ •μƒμ μΌλ΅ μ‘λ™ν•λ”μ§€ ν™•μΈν•λ‹¤.
  - λ„λ©”μΈ κ°μ²΄κ°„μ `μ—°κ΄€κ΄€κ³„`μ— λ€ν•΄μ„ ν•™μµν•λ‹¤.
- `Annotation` μ μ‚¬μ©μ— λ€ν•΄μ„ κ³ λ―Όν•λ‹¤.
  - μƒμ„±μλ¥Ό μ„ν• μ–΄λ…Έν…μ΄μ… μ„ νƒμ„ ν•™μµν•λ‹¤.
  - ν•™μµν• μ–΄λ…Έν…μ΄μ…μ„ κ³ λ ¤ν•΄ μ—”ν‹°ν‹° κ°μ²΄μ— μ μ ν•κ² μ μ©ν•λ‹¤.
- `μ•”νΈν™”`μ— λ€ν•΄μ„ ν•™μµν•λ‹¤.
  - μ•”νΈν™”μ— λ€ν•΄μ„ μ¤μ¤λ΅ μ°Ύμ•„λ³΄λ©°, ν•™μµν•λ‹¤.
  - ν•™μµν• κ°λ…μ„ κ°μ²΄μ— μ μ©ν•λ‹¤.

<br> 

--- 
### ν•™μµμ— μ•μ„ ν”„λ΅μ νΈλ¥Ό μ„ν• κΈ°λ³Έ μ„Έν…

κ°€μ¥ λ¨Όμ € `application.yml` μ„ κΈ°λ³Έμ μΈ μ„¤μ •ν•λ‹¤.
```yaml
spring:
  h2:
    console:
      enabled: true
      path: /h2
  datasource:
    url: jdbc:h2:mem:test
    driver-class-name: org.h2.Driver
    username: sa
    password:
  jpa:
    hibernate:
      ddl-auto: create
    generate-ddl: true
    show-sql: true
    properties:
      hibernate:
        format_sql: true
```
μ½μ†”λ΅ λ“¤μ–΄κ°€μ„ λ°μ΄ν„°λ² μ΄μ¤μ— μ—”ν‹°ν‹°κ°€ μ μƒμ„±λμ—λ”μ§€, JPAμ κΈ°λ³Έμ μΈ μ„¤μ •μ„ ν•΄μ£Όμ—λ‹¤. sqlλ„ μ–΄λ–»κ² μƒμ„±λλ”μ§€
ν™•μΈν•λ” μ„¤μ •λ„ ν¬ν•¨λμ–΄ μλ‹¤. μ΄ν›„ ν”„λ΅μ νΈκ°€ μ§„ν–‰ν•λ©° κ³ λ„ν™” λ  μ‹μ μ—λ” λ©”λ¨λ¦¬ λ””λΉ„μ—μ„ mysql λ“± λ””λΉ„λ΅ κµμ²΄ν•΄λ³Ό μμ •μ΄λ‹¤.

## Entity μ— λ€ν•΄μ„ ν•™μµν•κΈ°

### BaseEntity
μ—”ν‹°ν‹°μ—λ” κ³µν†µλλ” μ†μ„±μ΄ μ΅΄μ¬ν•λ‹¤. μ΄λ¥Ό `JPA`μ `Auditing` κΈ°λ¥μ„ μ΄μ©ν•΄μ„ κ΄€λ¦¬ν•λ„λ΅ ν•λ‹¤.

μ£Όλ΅ μ—”ν‹°ν‹°μ— μ‚¬μ©ν•λλ” μ†μ„±μΌλ΅ `createAt`, `updateAt`. μ΄λ¥Ό κ³µν†µμ μΌλ΅ κ΄€λ¦¬ν•λ” `baseEntity`λ¥Ό λ§λ“¤μ–΄μ„ κ΄€λ¦¬ν•΄λ³΄κ³ μ ν•λ‹¤.   


`@MappedSuperclass`λ€    

κ°μ²΄ μƒμ†μ„ ν•΄λ‹Ή μ–΄λ…Έν…μ΄μ…μ„ ν†µν•΄ κ³µν†µλλ” λ¶€λ¨ κ°μ²΄λΌλ” κ²ƒμ„ μ–΄λ…Έν…μ΄μ…μΌλ΅ μ„¤μ •ν•λ‹¤. μƒμ†κ΄€κ³„ λ§¤ν•‘μ λ©μ λ³΄λ‹¤ **κ³µν†µ λ§¤ν•‘ μ •λ³΄**κ°€ ν•„μ”ν•  λ• μ‚¬μ©ν•λ‹¤. 
νΉμ • μ†μ„±μ„ `Entity` μƒμ„± μ‹ μƒμ†λ°›μ•„ μ¤‘λ³µλλ” μ†μ„±μ„ μ²λ¦¬ν•λ” λ°μ— μλ―Έλ¥Ό λ‘”λ‹¤.   

<br>

```java
@Getter
@MappedSuperclass
public class BaseEntity {
    
    //@CreationTimestamp
    @CreateDate
    @Column(name="created_at", nullable=false, updateable = false)
    private LocalDateTime createdAt;
    
    //@UpdateTimestamp
    @LastModifiedDate
    @Column(name="updated_at", nullable = false)
    private LocalDateTime updatedAt;
}
```

`@Column`μ μ†μ„± `nullable`μ€ κΈ°λ³Έμ μΌλ΅ `true` μ κ°’μ„ κ°€μ§„λ‹¤. μ΄λ” κΈ°λ³Έμ μΌλ΅ `null` μ΄ λ“¤μ–΄μ¬ μ μλ‹¤. 
(μ¦‰, ν•΄λ‹Ή ν•„λ“λ” DDL μƒμ„± μ‹ null μ΄ λ“¤μ–΄κ° μ μλ‹¤.) 

λ§μ•½ `nullable` ν• κ°’μ„ λ„£μ§€ μ•μΌλ ¤λ©΄. `not null` λ΅ μ„¤μ •ν•κ³  μ‹¶μΌλ©΄ μ†μ„± κ°’μ„ `false`λ΅ μ£Όμ–΄μ£Όμ.
> - `@CreateDate`  `@LastModifiedDate`   
> - `@CreationTimeStamp`  `@UpdateTimeStamp`

### Auditing
κ°μ‚¬, μ‹¬μ‚¬μ μλ―Έλ¥Ό κ°€μ§„λ‹¤. μ΄λ” μ—”ν‹°ν‹°κ°€ μμ •, μƒμ„±λλ” μ‹μ μ„ κ°μ§€ν•μ—¬ κ·Έ μ‹κ°„κ³Ό μƒμ„±, μμ • ν• μ‚¬λμ„
κΈ°λ΅ν•μ—¬ μ΄λ ¥μ„ λ‚¨κΈΈ μ μμµλ‹λ‹¤.

λ‘ κ°€μ§€ λ°©λ²•μ΄ μ΅΄μ¬
- `@EnableJpaAuditing` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ κΈ°λ¥ ν™μ„±ν™” : `Application` ν΄λμ¤ λ λ²¨μ—μ„ μ–΄λ…Έν…μ΄μ…μ„ μ¶”κ°€

```java
@EnableJpaAuditing
@SpringBootApplication
public class XXXApplication {

    public static void main(String[] args) {
        SpringApplication.run(BlogdemoApplication.class, args);
    }
}
```

- Configuration λ¶„λ¦¬
```java
@EnableJpaAuditing
@Configuration
public class AuditingConfig {
    
}
```

π¨ `configuration` λ“±λ΅ μ‹ test code μ‘μ„± ν΄λμ¤μ— `@Import` μ–΄λ…Έν…μ΄μ…μΌλ΅ Jpa μ„¤μ •μ •λ³΄λ¥Ό μ¶”κ°€ν•΄μ£Όμ–΄μ•Ό ν•©λ‹λ‹¤.
```java
@DataJpaTest
@Import(JpaConfig.class)
class TodoRepositoryTest {
    
}
```

<br>

μ¤ν”„λ§λ¶€νΈλ¥Ό μ‹μ‘ν•λ” κ³³μ— μ–΄λ…Έν…μ΄μ…μ„ μ¶”κ°€ν•΄μ£Όλ” λ°©λ²•κ³Ό `configuration` ν΄λμ¤λ¥Ό λ§λ“¤μ–΄ μ„¤μ •ν•΄μ£Όλ” λ°©λ²•μ€ μ΅°κΈ λ‹¤λ¥΄λ‹¤.   
μ°¨μ΄μ μ€ λ‹¤μκ³Ό κ°™λ‹¤. 
- `Jpa`μ—μ„ μ κ³µν•λ” κΈ°λ¥μΈκ°€? 
- `Hibernate` μ—μ„ μ κ³µν•λ” κΈ°λ¥μΈκ°€?

μ§€κΈ λ³΄λ” `BaseEntity`μ— μ¶”κ°€ν•λ” κΈ°λ¥μ€ `Jpa`μ—μ„ μ κ³µν•λ” κΈ°λ¥μΌλ΅ ν•μ΄λ²„λ„¤μ΄νΈλ³΄λ‹¤ μ¶”κ°€λ΅ λ” λ§μ€ κΈ°λ¥ `μƒμ„±, μμ • μ‚¬μ©μ κΈ°λ΅ κΈ°λ¥` μ„ μ κ³µν•κ³ 
Spring μƒνƒκ³„μ™€ μ ν†µν•©λμ–΄ λ§μ΄ ν™μ©λλ‹¤.

```java
@Getter
@MappedSuperClass
@EntityListeners(AuditingEntityListener.class)
public abstract class BaseEntity {

    @CreatedDate
    @Column(name = "create_at", nullable = false, updatable = false)
    private LocalDateTime createAt;
  
    @LastModifiedDate
    @Column(name = "update_at", nullable = false)
    private LocalDateTime updateAt;
}
```

`Jpa` μ—μ„ μ κ³µν•λ” μμ •ν• μ‚¬λ, μƒμ„±ν• μ‚¬λμ„ λ“±λ΅ν•κ³  μ‹¶μ„λ•

```java
@CreateBy
@Column(updateable = false)
private String createdBy;

@LastModifedBy
private String lastModifiedBy;
```

### μ—°κ΄€κ΄€κ³„ λ§¤ν•‘ν•κΈ°
μ—”ν‹°ν‹°λ¥Ό λ¨Όμ € μ„¤κ³„ν•λ‹¤. 
1. `post` μ—”ν‹°ν‹° 
2. `comment` μ—”ν‹°ν‹°
3. `User` μ—”ν‹°ν‹°

`User (1) ----< (N)  Post (1) -----< (M) comment`

### μ—°κ΄€κ΄€κ³„μ μ£ΌμΈμ€ λ„κµ¬?
μ—°κ΄€κ΄€κ³„ λ§¤ν•‘μ μ£ΌμΈμ΄λ€ λ¬΄μ—‡μΈκ°€?   
μ—°κ΄€κ΄€κ³„ μ£ΌμΈμ΄ ν•„μ”ν• μ΄μ  : κ°μ²΄ μ§€ν–¥μ ν¨λ¬λ‹¤μ„κ³Ό λ°μ΄ν„°λ² μ΄μ¤μ ν¨λ¬λ‹¤μ„μ— μ°¨μ΄κ°€ μκΈ° λ•λ¬Έμ΄λ‹¤.

> `μ–‘λ°©ν–¥` : λ‘ κ°μ²΄ λ¨λ‘κ°€ κ°κ° μ°Έμ΅°μ© ν•„λ“λ¥Ό κ°–κ³  μ°Έμ΅°ν•λ‹¤.   
> `λ‹¨λ°©ν–¥` : λ‘ κ°μ²΄ μ‚¬μ΄μ— ν•λ‚μ κ°μ²΄λ§ μ°Έμ΅°μ© ν•„λ“λ¥Ό κ°€μ§€κ³  μ°Έμ΅°ν•λ‹¤.

μ—°κ΄€κ΄€κ³„μ μ£ΌμΈ `mappedBy`

μ—°κ΄€κ΄€κ³„μ μ£ΌμΈμ„ μ§€μ •ν•λ‹¤λ” κ²ƒμ€, κ°μ²΄μ λ‘ κ΄€κ³„ μ¤‘ μ μ–΄μ κ¶ν• (λ°μ΄ν„° μ΅°ν, μ €μ¥, μμ •, μ‚­μ )λ¥Ό
κ°–λ” μ‹¤μ§μ μΈ κ΄€κ³„κ°€ λ¬΄μ—‡μΈμ§€ `JPA`μ— μ•λ¦¬λ” κ²ƒ   
λ”°λΌμ„ μ—°κ΄€κ΄€κ³„μ μ£ΌμΈμ€ μ—°κ΄€κ΄€κ³„λ¥Ό κ°–λ” λ‘ κ°μ²΄ μ‚¬μ΄μ—μ„ μ΅°ν, μ €μ¥, μμ •, μ‚­μ λ¥Ό ν•  μ μμ§€λ§,
μ£ΌμΈμ΄ μ•„λ‹λ©΄ **μ΅°ν**λ§ κ°€λ¥ν•λ‹¤.

λ„κµ¬λ¥Ό μ£ΌμΈμΌλ΅ μ§€μ •ν•΄μ¤μ•Ό ν•λ”κ°€? κ°„λ‹¨ν•κ² μ£ΌμΈμ€ **μ™Έλν‚¤κ°€ μλ” κ³³μ„ μ£ΌμΈ**μΌλ΅ μ§€μ •ν•λ©΄ λλ‹¤.
ERDμ—μ„ 1λ€ N κ΄€κ³„λ¥Ό μ„¤κ³„ν•  λ•, NμΈ΅ μ—”ν‹°ν‹°κ°€ 1μΈ΅ μ—”ν‹°ν‹°μ IDλ¥Ό μ°Έμ΅°ν•λ” λ°©μ‹μΌλ΅ κ΄€κ³„λ¥Ό λ§Ίλ”λ‹¤.   


## κΈ°λ³Έ μƒμ„±μ μ–΄λ…Έν…μ΄μ…
### `@NoArgsConstructor`   

κΈ°λ³Έ μƒμ„±μλ¥Ό μƒμ„±ν•΄μ£Όλ” μ–΄λ…Έν…μ΄μ…μ΄λ‹¤. μλ°”μ—μ„ μƒμ„±μλ¥Ό μ„ μ–Έν•  λ• μƒμ†λ°›λ” κ°μ²΄κ°€ μλ‹¤λ©΄, μμ‹ μƒμ„±μ μ—μ„λ” λ¶€λ¨ ν΄λμ¤λ¥Ό μƒμ„±ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤. μ¤ν”„λ§λ¶€νΈμ—μ„λ” μ—”ν‹°ν‹°λ¥Ό μƒμ„±ν•  λ• ν”„λ΅μ‹ κ°μ²΄λ¥Ό ν†µν•΄ κ°μ²΄λ¥Ό μƒμ„±ν•κΈ° λ•λ¬Έμ— κΈ°λ³Έ μƒμ„±μκ°€ `Default` μ΄λ‹¤.   

μ™Έλ¶€μ—μ„λ” ν•΄λ‹Ή μƒμ„±μ νΈμ¶μ„ ν•μ§€ λ»ν•λ„λ΅ μ ‘κ·Ό μ μ–΄μλ¥Ό `protected` μ„¤μ •ν•΄μ¤€λ‹¤. κ°μ²΄λ¥Ό μ„¤κ³„ν•  λ• λ‚λ” κΈ°λ³Έ μƒμ„±μλ΅ μ™Έλ¶€μ—μ„ μƒμ„±ν•λ” κ²ƒμ„ 
μ›ν•μ§€ μ•κΈ° λ•λ¬Έμ΄λ‹¤. μ΄ κΈ°λ³Έ μƒμ„±μ μ–΄λ…Έν…μ΄μ…μ€ μ¤μ§ `Jpa` μ—μ„ ν”„λ΅μ‹ κΈ°λ¥μ„ μ„ν•  λΏμ΄κΈ° λ•λ¬Έμ΄λ‹¤.

> μμ‹ κ°μ²΄μ—μ„λ” κ°μ²΄ μƒμ„±μ„ ν•  λ• κΈ°λ³Έμ μΌλ΅ λ¶€λ¨κ°μ²΄λ„ μƒμ„±μ„ ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.  
> `super` μμ•½μ–΄λ¥Ό ν†µν•΄ μμ‹ κ°μ²΄κ°€ μƒμ„±λκΈ°μ „μ— λ¶€λ¨κ°μ²΄λ¥Ό μƒμ„±ν•λ‹¤.


κ°μ²΄λ¥Ό `DB` μ—μ„ μ΅°νν•΄ μ¬ λ• `LAZY` λ°©μ‹μ΄λƒ, `EAGER` λ°©μ‹μ΄λƒμ— λ”°λΌμ„ ν”„λ΅μ‹ κ°μ²΄λ΅ μ΅°νν•΄ μ¬μ§€ κ²°μ •μ„ ν•κ²λλ‹¤. 
`LAZY` λ°©μ‹μΌλ΅ μ΅°νλ¥Ό ν•΄μ¬λ•λ” ν”„λ΅μ‹ κ°μ²΄λ¥Ό μ΄μ©ν•κΈ° λ•λ¬Έμ— κΌ­
**κΈ°λ³Έ μƒμ„±μμ μ ‘κ·Όμ μ–΄μλ¥Ό `public` λλ” `protected`λ΅ μ„¤μ •**μ„ ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.

### μ μ €μ μ •λ³΄λ¥Ό μ–΄λ–»κ² μ—”ν‹°ν‹°μ— μ„¤κ³„ν•΄μ•Όν• κΉ? - μ–΄λ…Έν…μ΄μ… μ μ©ν•΄λ³΄κΈ°
μ μ €μ μ •λ³΄λ¥Ό μ €μ¥ν•κ³  μλ” `User`κ°μ²΄ μ—”ν‹°ν‹°

μ—”ν‹°ν‹° λ‚΄λ¶€μ— κ°μ²΄λ΅ μ •λ³΄λ¥Ό μ €μ¥ν•κ³  μλ” `UserInfo` λΌλμ§€, `Email`, `PostPhone` λ“±μ€ κ°μ²΄λ΅ κ΄€λ¦¬ν•λ”κ² μΆ‹μ„κΉ?
κ°μ²΄μ§€ν–¥ν”„λ΅κ·Έλλ°μ„ ν•λ”λ° κ³ λ―Όμ΄λλ‹¤.

κ°„λ‹¨ν• ν”„λ΅μ νΈμΌ κ²½μ° λΉ λ¥΄κ² ν”„λ΅ν†  νƒ€μ…μΌλ΅ String ν•„λ“λ΅ μ‘μ„±ν•λ‹¤.

`Email`μ΄λ‚, `PhoneNumber`λ” κ°μ²΄λ΅ λ§λ“¤μ–΄μ„ κ΄€λ¦¬ν•΄λ„ κ΄μ°®μ„ κ²ƒ κ°™λ‹¤.  μΌλ‹¨ `Emial`μ€ νΉμ • λ„λ©”μΈμ— λ”°λΌμ„ λ‹¤λ¥΄κ² μ²λ¦¬ν•  κ²½μ°μ— μ μ©ν•κ² μ‚¬μ©ν•  μ μμ„ κ²ƒ κ°™λ‹¤.

<br/>

`Email` κ°μ²΄ κΈ°λ¥μ„ κ³ λ ¤ν•΄λ³Όλ§ν• μ‚¬ν•­
- μ •κ·μ‹μ„ μ΄μ©ν•μ—¬ μƒμ„± κ²€μ‚¬
- λ§μ¤ν‚Ή
- λ„λ©”μΈ μ •λ³΄ νΈμ¶
```java
@Embeddable
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EqualsAndHashCode
public class Email {
    private static final String PATTERN = "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$";
    private static final Pattern EMAIL_PATTERN = Pattern.compile(PATTERN);
    private String email;

    private Email(String email) {
        this.email = email;
    }

    public static Email of(String email) {
        ValidOrThrow(email);
        return new Email(email);
    }

    private static void validOrThrow(String email) {
        Objects.requireNonNull(email, "email must not be null");
        if (!isValidEmail(email)) {
            String format = String.format("Invalid email address: %s", email);
            throw new IllegalArgumentException(format);
        }
    }

    private static boolean isValidEmail(String email) {
        return EMAIL_PATTERN.matcher(email).matches();
    }
}
```

μ΄λ°μ‹μΌλ΅ `Email` μ„ κ²€μ¦ν•κ³  μƒμ„±ν•λ” λ΅μ§μ„ μΊ΅μν™”ν–λ‹¤.

μ΄μ  μ λ€λ΅ μ‘λ™ν•λ”μ§€, ν…μ¤νΈν•΄λ³΄κ³  μ‹¶μ€ μ•κµ¬κ°€ μλ”λ‹¤. μ¶”κ°€λ΅ κ³ λ―Όλλ” λ¶€λ¶„μ΄ 
`Email`μ€ κ°’ κ°μ²΄λ΅ λ¶λ³€μΌλ΅ λ§λ“¤μ–΄μ•Ό ν• ν…λ° μ΄μ™€ κ΄€λ ¨λ μλ£λ” λ” μ°Ύμ•„λ΄μ•Ό ν•  κ²ƒ κ°™λ‹¤.


### User Entity
μ—”ν‹°ν‹°μ μƒμ„±μμ— λ€ν•΄μ„ μ–΄λ–»κ² ν•΄μ•Όν•λ”μ§€ κ³ λ―Όμ΄ λμ—λ‹¤. μ–΄λ–¤ μ–΄λ…Έν…μ΄μ…μ„ λ¶™μ—¬μ£Όμ–΄μ•Όν• μ§€!
```java

@Builder
@AllArgsConstructor(access = AccessLevel.PRIVATE)
@Getter
@Entity
@Table(name = "users")
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class User extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @Column(nullable = false, length = 50)
    private String username;

    // TODO μ…λ ¥μ„ λ°›μ„ λ• μ»¨νΈλ΅¤λ¬ λ μ΄μ–΄μ—μ„ μ…λ ¥μ„ κ²€μ¦ν•λ” validator λ¥Ό λ§λ“¤μ–΄ κ²€μ¦ν•μ!
    @Column(nullable = false, length = 50)
    private String encryptedPassword;

    @Embedded
    private Email email;

    public static User create(String username, Email email, String encryptedPassword) {
        return User.builder()
                .username(username)
                .email(email)
                .encryptedPassword(encryptedPassword)
                .build();
    }
}
```

λ‚΄κ°€ λ‚΄λ¦° κ²°λ΅ μ€ μ„μ μ½”λ“ λ°©μ‹μΌλ΅ μ—”ν‹°ν‹° κ°μ²΄λ¥Ό μ„¤κ³„ν•λ” κ²ƒμ΄λ‹¤. μ™ μ΄λ ‡κ² ν–λ”μ§€ λ‚΄κ°€ μƒκ°ν• λ¶€λ¶„μ— λ€ν•΄μ„
μ„¤λ…ν•΄λ³΄κ² λ‹¤.

μΌλ‹¨ `AllArgsConstructor` λ¥Ό `private` μ ‘κ·Όμ μ–΄μλ¥Ό μ‚¬μ©ν• μ΄μ λ” κ°μ²΄ μƒμ„±μ„ ν©ν† λ¦¬ λ©”μ„λ“λ¥Ό ν†µν•΄
μƒμ„±ν•λ„λ΅ ν•κ³  μ‹¶μ—λ‹¤. κ·Έλ¦¬κ³  κ°μ²΄λ¥Ό μƒμ„±ν•λ” μƒμ„±μμ—μ„λ” μƒμ„±λ§ ν•λ” λ΅μ§μ„ μ±…μ„μ§€κ² λ§λ“¤κ³  μ‹¶μ—λ‹¤.

λΉλ”λ” κ°μ²΄ μƒμ„±μ„ ν•λ”λ°, μ™Έλ¶€μ—μ„λ„ νΈμ¶ν•  μ μλ‹¤. μ΄κ² μ¥μ μΈμ§€ λ‹¨μ μΈμ§€λ” μ λ¨λ¥΄κ² λ‹¤. κΈ°λ³Έμ μΌλ΅
μ •μ  ν©ν† λ¦¬ λ©”μ„λ“λ¥Ό ν†µν•΄ κ°μ²΄λ¥Ό μƒμ„±ν•λ„λ΅ ν•κ³ , ν•„μ”μ‹μ—λ” λΉλ”λ¥Ό μ‚¬μ©ν•΄λ„ λ  κ²ƒκ°™μ€λ°, 
ν”„λ΅μ νΈλ¥Ό μ΅°κΈ λ” μ§„ν–‰ν•΄λ³΄λ©΄μ„ μ΄κ² μ‚¬μ©λλ”μ§€ μ‚΄ν΄λ³΄μ•„μ•Ό ν•  κ²ƒκ°™λ‹¤.

## `Entity` ν…μ¤νΈλ” μ–΄λ–»κ² ν•λ‚?
### `@SpringBootTest`, `@DataJpaTest`μ μ°¨μ΄λ” λ¬΄μ—‡μΈκ°€?

`@DataJpaTest`λ” μ¤μ§ `JPA` μ»΄ν¬λ„νΈλ“¤λ§ ν…μ¤νΈν•κΈ° μ„ν• μ–΄λ…Έν…μ΄μ…μ΄λ‹¤. μ¤ν”„λ§λ¶€νΈμ λΉλ“¤μ μμ΅΄μ„±μ„ ν•΄μ ν• ν›„
μΈλ©”λ¨λ¦¬ λ””λΉ„λ΅ ν…μ¤νΈν•  μ μλ‹¤. `Repository` μμ²΄μ λ©”μ„λ“μ— λ€ν• λ‹¨μ„ν…μ¤νΈλ¥Ό μ§„ν–‰ν•λ‹¤.

- λ©”λ¨λ¦¬μƒ λ‚΄λ¶€ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μƒμ„±ν•κ³ , `@Entiy` ν΄λμ¤λ“¤μ„ λ“±λ΅ν•κ³  JPA Repository μ„¤μ •λ“¤μ„ ν•΄μ¤€λ‹¤. κ° ν…μ¤νΈλ§λ‹¤ μ™„λ£λλ©΄ λ΅¤λ°±λλ‹¤.

> ν…μ¤νΈ ν•  λ• λ€μƒ κ°μ²΄μ μ—”ν‹°ν‹°μ—λ” κΈ°λ³Έμƒμ„±μλ” μ‚¬μ©ν•  μ μ—†λ„λ΅ `protected` μ ‘κ·Όμ μ–΄μμΈλ°, μƒμ„±μ„ μ–΄λ–»κ² ν•λ”κ² μΆ‹μ„μ§€ κ³ λ―Ό
> 1. AllArgsConstructor
> 2. Builder
> 3. Static Factory method   

<br>

`@SpringBootTest` λ” full application config μ„ λ΅λ“ν•΄μ„ ν†µν•©ν…μ¤νΈλ¥Ό μ§„ν–‰ν•κΈ° μ„ν• μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.
- μ„¤μ •ν•΄λ†“μ€ `config`, `context`, `components` λ¨λ‘ λ΅λ“ν•λ‹¤.
- `DataSource` `bean` μ„ κ·Έλ€λ΅ μ‚¬μ©ν•κΈ° λ•λ¬Έμ— μ‹¤μ  λ””λΉ„ μ„λΉ„μ¤μ™€ μ—°κ²°λλ‹¤.
- ν…μ¤νΈν•  λ•λ§λ‹¤ DBκ°€ λ΅¤λ°±λμ§€ μ•κΈ° λ•λ¬Έμ— `@Transactional` μ–΄λ…Έν…μ΄μ…μ„ λ‹¬μ•„μ£Όμ–΄μ•Ό ν•λ‹¤.

### λ ν¬μ§€ν„°λ¦¬ ν…μ¤νΈ μ½”λ“ 
λ ν¬μ§€ν„°λ¦¬μ—μ„ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•κΈ° μ„ν•΄μ„λ” μ„¤μ •μ •λ³΄λ¥Ό μ§€μ •ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.

μ°μ„  `JpaConfig` ν΄λμ¤λ¥Ό μƒμ„±ν•μ—¬ `Jpa Auditing` κΈ°λ¥μ„ μ‚¬μ©ν•κΈ°μ„ν•΄μ„ μ–΄λ…Έν…μ΄μ…μ„ μ„¤μ •ν•΄μ¤€λ‹¤.
```java
@Configuration
@EnableJpaAuditing
public class JpaConfig {
}
```

κ·Έλ¦¬κ³  ν…μ¤νΈ ν΄λμ¤μ—μ„ import ν•΄μ¤€λ‹¤.
```java
@DataJpaTest
@Import(JpaConfig.class)
class repositoryTest {}
```

`@Import` μ†μ„±μΌλ΅ λ“¤μ–΄κ°„ ν΄λμ¤μ μ΄λ¦„μ΄ λ™μΌν•κ² μ„¤μ •μ„ ν•΄μ£Όλ©΄λλ‹¤.

ν΄λμ¤ μ΄λ¦„μ΄ μ΅°κΈ μλ„λ¥Ό λ‚νƒ€λ‚΄κΈ°μ— λΉμ•½ν• λ¶€λ¶„μ΄ μλ”κ²ƒ κ°™λ‹¤. λ‹¤μκ³Ό κ°™μ΄ μμ •ν•  μ μμ„ κ²ƒ κ°™λ‹¤.

```java
class JpaAuditingConfiguration {}
```

κ·Έλ¦¬κ³  κ΄€λ ¨ μ •λ³΄λ¥Ό μ΅°κΈ λ” μ°Ύμ•„λ³΄λ‹¤ μ νλΈμ—μ„ λ‹¤μκ³Ό κ°™μ€ μ–΄λ…Έν…μ΄μ…μ„ λ°κ²¬ν–λ‹¤.

```java
@AutoConfigureTestDatabase(connection = EmbeddedDatabaseConnection.H2)
```
μμ„Έν•κ²λ” λ¨λ¥΄μ§€λ§, ν…μ¤νΈ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ„¤μ •ν•λ” μ–΄λ…Έν…μ΄μ…μΌλ΅ λ³΄μΈλ‹¤. μ†μ„± κ°’μ„ H2, NONE
λ‘ λ‹¤ μ μ©ν•΄λ³΄μ•λ”λ°, μ°¨μ΄κ°€ μ—†μ΄ μ‹¤ν–‰μ΄ λμ—λ‹¤.

`@ActiveProfiles(value = "application.yaml")` : test λ¦¬μ†μ¤μ— λ„£μ–΄λ‘” νμΌμ„ ν™μ„±ν™” μ‹ν‚¤λ” κ²ƒμΌλ΅ λ³΄μΈλ‹¤.

μ‚¬μ©ν•  μ μλ” μ–΄λ…Έν…μ΄μ…μ΄ λ„λ¬΄ λ§μ•„μ„ ν•λ‚ν•λ‚ ν•„μ”ν•  λ• μ°Ύμ•„μ„ μ μ©ν•΄λ³΄λ ¤κ³  ν•λ‹¤.

μ •λ¦¬ν•μλ©΄, jpa Auditing κΈ°λ¥μ„ ν™μ„±ν™”λ¥Ό ν…μ¤νΈ μ½”λ“ μ‘μ„±μ‹μ— ν•΄μ£Όλ ¤λ©΄ `Import` μ–΄λ…Έν…μ΄μ…μΌλ΅ `JpaConfig.class` λ¥Ό 
μ†μ„±μΌλ΅ μ£Όμ–΄μ•Ό μ„±κ³µν•  μ μλ‹¤λ” κ²ƒμ„ μ• μ μμ—λ‹¤.

# μ—”ν‹°ν‹°λ¥Ό μ΅°νν•΄μ¬ λ• ν…μ¤νΈ μ½”λ“ μ‘μ„±μ–΄λ–»κ² ν•΄μ•Όν• κΉ?"

μΌλ‹¨ μƒκ°λ‚λ” λ°©λ²•μ€ μ½”λ“λ λ²¨μ—μ„ μ—”ν‹°ν‹°λ¥Ό μƒμ„±ν•΄μ„ λ ν¬μ§€ν„°λ¦¬μ— μ €μ¥μ„ ν• ν›„μ—
μ €μ¥ν• κ°’μ„ κ°€μ§€κ³  μ΅°νλ¥Ό ν•΄μ¤λ” λ°©λ²•μ΄ μκ³ , λ―Έλ¦¬ ν…μ¤νΈ λ°μ΄ν„°λ² μ΄μ¤μ— μ½”λ“λ¥Ό μ£Όμ–΄μ„ λ§¤
μ‹¤ν–‰μ‹λ§λ‹¤ λ°μ΄ν„°λ¥Ό μ €μ¥ν•λ” sql νμΌμ„ μ¤μ„ ν•λ” λ°©λ²•μ΄ μμ„ κ²ƒ κ°™λ‹¤.

μ΄μ—λ€ν•΄μ„ μ΅°κΈ λ” μ •λ¦¬ν•΄λ³΄μ.

## 1. ν…μ¤νΈ μ½”λ“ λ λ²¨μ—μ„ λ°μ΄ν„° μ €μ¥ ν›„ μ΅°ν ν…μ¤νΈ
μ¥μ 
- ν…μ¤νΈ λ°μ΄ν„°κ°€ λ…μ‹μ μ΄λ―€λ΅ μ½”λ“λ§ λ΄λ„ λ°μ΄ν„°μ μƒνƒλ¥Ό μ‰½κ² μ΄ν•΄
- νΉμ • ν…μ¤νΈμ— λ§λ” λ°μ΄ν„°λ§ μƒμ„±ν•  μ μμ–΄ ν…μ¤νΈμ λ©μ μ„ λ…ν™•ν ν‘ν„ κ°€λ¥

λ‹¨μ 
- λ°μ΄ν„° μƒμ„± μ½”λ“κ°€ λ°λ³µλ  κ°€λ¥μ„±μ΄ μμ
- ν…μ¤νΈκ°€ λ³µμ΅ν•΄μ§ κ²½μ°, λ°μ΄ν„° μ¤€λΉ„ μ½”λ“κ°€ κΈΈμ–΄μ§ μ μμ

## 2. Test Resourceλ¥Ό ν™μ©ν• λ°μ΄ν„° μ¤€λΉ„
νΉμ§•
- SQL νμΌμ΄λ‚ `data.sql` νμΌμ„ μ΄μ©ν•΄ ν…μ¤νΈ λ°μ΄ν„°λ² μ΄μ¤μ— λ―Έλ¦¬ λ°μ΄ν„°λ¥Ό μ €μ¥ν•΄λ‘κ³ , ν…μ¤νΈ μ½”λ“μ—μ„ μ΅°νλ§ μ‹¤ν–‰

μ¥μ 
- λ°μ΄ν„°λ² μ΄μ¤ μ΄κΈ°ν™” λ° λ°μ΄ν„° μ¤€λΉ„κ°€ μ™Έλ¶€ν™”ν•  μ μμ–΄ μ½”λ“κ°€ κ°„κ²°ν•΄μ§
- λ‹¤μ–‘ν• λ°μ΄ν„° μ„ΈνΈλ¥Ό κ΄€λ¦¬ν•κΈ° μ©μ΄ν•¨ (ν…μ¤νΈ λ©μ μ— λ”°λΌ λ‹¤λ¥Έ λ°μ΄ν„° μ„ΈνΈλ¥Ό μ¤€λΉ„ κ°€λ¥)

λ‹¨μ 
- λ€κ·λ¨ ν…μ¤νΈμ—μ„λ” λ°μ΄ν„°λ¥Ό λ―Έλ¦¬ μ¤€λΉ„ν•λ” λ° μ‹κ°„μ΄ κ±Έλ¦΄ μ μμ (νμ΄μ§• ν•  λ°μ΄ν„°)
- ν…μ¤νΈ λ°μ΄ν„°κ°€ μ½”λ“ μ™Έλ¶€μ— μ΅΄μ¬, λ°μ΄ν„°μ™€ ν…μ¤νΈ κ°„μ μ—°κ΄€μ„± μ΄ν•΄κ°€ μ–΄λ ¤μ›μ§ (λ‚λ” λ‘ κ°κ°€ λ¶„λ¦¬λλ‹κΉ μ¤νλ ¤ μΆ‹μ€κ±° μ•„λ‹κ°€?)

μ„¤μ • λ°©λ²•
1. `src/test/resources/data.sql` νμΌ μƒμ„±
```sql
INSERT INTO user (id, username, email) VALUES (1, 'kim', 'kim@example.com');
INSERT INTO user (id, username, email) VALUES (2, 'lee', 'lee@example.com');
```
μƒκ°ν•΄λ΄¤λ”λ°, μ”κµ¬μ‚¬ν•­μ΄ λ³€κ²½λκ±°λ‚, ν•„λ“κ°€ λ³€κ²½λ  κ²½μ°μ— λ°μ΄ν„° κ΄€λ¦¬κ°€ λ§¤μ° νλ“¤μ§€ μ•μ„κΉ μƒκ°μ΄λ“¦

# μ•”νΈν™”
=> λ‹¨λ°©ν–¥, μ–‘λ°©ν–¥

- λ‹¨λ°©ν–¥ : hash λ°©μ‹, λ‹¨λ°©ν–¥μ€ λ³µνΈν™”κ°€ μ•λλ‹¤
- μ–‘λ°©ν–¥ : λ³µνΈν™” κ°€λ¥ (λ€μΉ­ν‚¤, κ³µκ°ν‚¤ λ°©μ‹)

ν¨μ¤μ›λ“ μ•”νΈν™” μ”κµ¬μ΅°κ±΄
- λ³µνΈν™”κ°€ λ¶κ°€λ¥ν•΄μ•Ό ν•λ‹¤.
- ν•΄μ‹ν•¨μ μ‚¬μ©(λ‹¨λ°©ν–¥)
- νΉμ • ν¨μ¤μ›λ“μ ν•΄μ‹κ°’μ΄ λ…Έμ¶λμ–΄λ„, κ°™μ€ ν¨μ¤μ›λ“μΈ λ‹¤λ¥Έ κ³„μ •λ„ νƒμ·¨λ‹Ήν•λ©΄ μ•λλ‹¤.
- salt ν•„μ”
- λΈλ£¨ν¬ ν¬μ¤ κ³µκ²©μ— λ€λΉ„ κ°€λ¥ν•΄μ•Όν•λ‹¤. (μ—°μ‚°μ†λ„ μ ν•)

ν„μ¬λ” `Bcrypt` μ•”νΈν™” μ•κ³ λ¦¬μ¦ λ§μ΄ μ‚¬μ©ν•λ” μ¶”μ„Έ

λ€μΉ­ν‚¤ , λΉ„λ€μΉ­ν‚¤
1) λ€μΉ­ν‚¤
  - μ•”λ³µνΈν™”μ— μ‚¬μ©ν•λ” ν‚¤κ°€ λ™μΌ
    - μ¥μ  : μ†λ„
    - λ‹¨μ  : ν‚¤κ°€ νƒμ·¨λ  κ°€λ¥μ„±
2) λΉ„λ€μΉ­ν‚¤(κ³µκ°ν‚¤)
  - μ•”λ³µνΈν™”μ— μ‚¬μ©ν•λ” ν‚¤κ°€ λ‘κ°μ΄λ‹¤.

## ν¨ν‚¤μ§€ μ–΄λ””μ— μ•”νΈν™” κµ¬ν„μ²΄λ¥Ό λ‘λ”κ² μ¤—μ„κΉ?
`Encryptor` κ°μ²΄λ” λΉ„λ°€λ²νΈ κ²€μ¦ κµ¬ν„μ²΄λ¥Ό μ„ν• ν¨ν‚¤μ§€ κµ¬μ΅°λ¥Ό μ„¤κ³„ν•  λ•, μΌλ°μ μΌλ΅
μ• ν”λ¦¬μΌ€μ΄μ…μ λ³΄μ• κ΄€λ ¨ λ΅μ§μ΄λ―€λ΅, λ…ν™•ν•κ³  λ…λ¦½μ μΈ μ„μΉμ— λ‘λ” κ²ƒμ΄ μΆ‹λ‹¤.

1. λ³΄μ• κ΄€λ ¨ ν¨ν‚¤μ§€ : `Security`, λλ” `auth` μ™€ κ°™μ€ ν¨ν‚¤μ§€μ— ν¬ν•¨
2. μ ν‹Έλ¦¬ν‹° κ΄€λ ¨ ν¨ν‚¤μ§€ : `Util` λλ” `common` ν¨ν‚¤μ§€ μ•”νΈν™” λ³΄νΈμ μΈ κΈ°λ¥μ€ λ‹¤λ¥Έ λ¶€λ¶„μ—μ„λ„ μ‚¬μ©κ°€λ¥

μ„¤κ³„ κΈ°μ¤€
1. μ±…μ„ λ¶„λ¦¬
  - μ•”νΈν™” λ΅μ§μ€ λΉ„μ¦λ‹μ¤ λ΅μ§(UserService) μ™€ λ¶„λ¦¬λμ–΄μ•Ό ν•λ―€λ΅, domain ν•μ„μ— λ‘λ” κ²ƒμ€ μ μ ν•μ§€ μ•λ‹¤.
  - `security` λλ” `common`κ³Ό κ°™μ€ λ…λ¦½μ μΈ ν¨ν‚¤μ§€μ— μ„μΉμ‹μΌ λ…ν™•ν• μ—­ν• μ„ λ¶€μ—¬ν•λ‹¤.
2. ν™•μ¥μ„±
  - λ‹¤λ¥Έ μΆ…λ¥μ μ•”νΈν™”κ°€ ν•„μ”ν• κ²½μ°λ¥Ό λ€λΉ„ν•΄, `encrpytor` μΈν„°νμ΄μ¤μ™€ κµ¬ν„μ²΄λ¥Ό λ¶„λ¦¬

```java

public class PasswordEncryptor implements Encryptor {

    @Override
    public String encrypt(String rawValue) {
        return BCrypt.hashpw(rawValue, BCrypt.gensalt());
    }

    @Override
    public boolean matches(String rawValue, String encryptedValue) {
        return BCrypt.checkpw(rawValue, encryptedValue);
    }
}

```

### μ•”νΈν™”ν•  λ• κΈ°λ³Έκ°’μΌλ΅ μ‚¬μ©ν•λ” κ²ƒ κ°™μ•„λ³΄μ΄λ”λ° μ•μ „ν• κΉ?

1. Salt λ°©μ‹ : `Bcrypt` λ” μ•”νΈν™”λ¥Ό μν–‰ν•  λ• λ‚΄λ¶€μ μΌλ΅ κ³ μ ν• Salt κ°’μ„ μλ™ μƒμ„±ν•©λ‹λ‹¤. μ΄ κ°’μ€ λ§¤λ² λ‹¬λΌμ§€λ―€λ΅ κ°™μ€ λΉ„λ°€λ²νΈλΌλ„ μ•”νΈν™” κ²°κ³Όκ°€ ν•­μƒ λ‹¤λ¥΄λ‹¤.
2. salt ν¬ν•¨ : μƒμ„±λ salt κ°’μ€ μ•”νΈν™”λ ν•΄μ‹ κ°’μ— ν¬ν•¨λλ©°, λΉ„λ°€λ²νΈ κ²€μ¦ μ‹ μλ™μΌλ΅ ν•΄μ λλ‹¤.

## Bcryptμ κΈ°λ³Έ Work Factor (Cost κ°’)
`Bcrypt.getsalt()`λ¥Ό νΈμ¶ν•λ©΄ κΈ°λ³Έ Work Factorλ” 10μΌλ΅ μ„¤μ •λλ‹¤. (ν•¨μ νƒ€κ³  λ“¤μ–΄κ°€λ©΄ 10μΈ κ²ƒμ„ μ• μ μμ)
μ΄ κ°’μ€ μ•”νΈν™” κ³Όμ •μ—μ„ ν•΄μ‹±μ„ λ‡ λ² λ°λ³µν• μ§€ κ²°μ •ν•λ©°, λ³΄μ• κ°•λ„μ™€ μ„±λ¥ κ°„μ κ· ν•μ„ μ„¤μ •ν•λ‹¤.
- κΈ°λ³Έκ°’μΈ 10μ€ μ•μ „ν•λ©΄μ„λ„ μ„±λ¥μ— μ ν•©ν• μμ¤€μΌλ΅ κ°„μ£Όλλ‹¤.
- λ” λ†’μ€ λ³΄μ•μ΄ ν•„μ”ν•λ‹¤λ©΄ Work Factorλ¥Ό μ¦κ°€μ‹ν‚¬ μ μλ‹¤.
```java
String hashed = BCrypt.hashpw("password123", BCrypt.gensalt(12)); // Work Factor 12
```

## Bcryptμ Saltλ¥Ό κΈ°λ³Έκ°’μΌλ΅ μ‚¬μ©ν•΄λ„ μ•μ „ν• μ΄μ 
1. Salt κ°€ μλ™ μƒμ„± λ° ν¬ν•¨
  - Bcryptλ” λΉ„λ°€λ²νΈλ§λ‹¤ κ³ μ ν• Saltλ¥Ό μƒμ„±ν•κ³  μ•”νΈν™”λ ν•΄μ‹μ— ν¬ν•¨μ‹ν‚¨λ‹¤.
  - κ²€μ¦ μ‹ Salt κ°’μ„ μλ™μΌλ΅ ν•΄μ ν•λ―€λ΅ μ¶”κ°€ κ΄€λ¦¬κ°€ ν•„μ” μ—†λ‹¤.
2. Rainbow Table κ³µκ²© λ°©μ§€ :
  - κ°™μ€ λΉ„λ°€λ²νΈλΌλ„ λ§¤λ² λ‹¤λ¥Έ Saltκ°€ μƒμ„±λλ―€λ΅ Rainbow Table κ³µκ²©μ΄ λ¶κ°€λ¥ν•λ‹¤.
3. λΉ„λ°€λ²νΈ μ μ¶” λ°©μ§€
  - Salt κ°’μ΄ λ§¤λ² λ‹¬λΌμ§€κΈ° λ•λ¬Έμ—, λ™μΌν• λΉ„λ°€λ²νΈλ¥Ό κ°€μ§„ μ‚¬μ©μλ„ μ„λ΅ λ‹¤λ¥Έ ν•΄μ‹ κ°’μ„ κ°–κ² λλ‹¤.

## Saltλ¥Ό μ§μ ‘ κ΄€λ¦¬ν•΄μ•Όν•λ” κ²½μ°
Bcryptμ κΈ°λ³Έ Salt μ²λ¦¬ λ°©μ‹μ€ λ€λ¶€λ¶„μ μ• ν”λ¦¬μΌ€μ΄μ…μ— μ¶©λ¶„ν μ•μ „ν•μ§€λ§, λ‹¤μκ³Ό κ°™μ€ νΉλ³„ν•
μ”κµ¬μ‚¬ν•­μ΄ μλ‹¤λ©΄ Saltλ¥Ό μ§μ ‘ κ΄€λ¦¬ν•  μ μλ‹¤.
- salt κ°’ μ¬μ‚¬μ© λ°©μ§€ : saltκ°’μ„ μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§μ—μ„ λ” λ³µμ΅ν•κ² κµ¬μ„±.
- λ‹¤λ¥Έ μ•”νΈν™” μ•κ³ λ¦¬μ¦ μ‚¬μ© : SHA256...

## μ•”νΈν™” κ°μ²΄λ¥Ό μ‚¬μ©ν•  λ• μ–΄λ–»κ² λ“±λ΅ν•΄μ•Όν• κΉ?
1. `Configuration` μΌλ΅ `λΉ`μΌλ΅ λ“±λ΅ν•λ‹¤.
2. `Component` λ΅ κ΄€λ¦¬ν•λ‹¤.

### λ‘ λ°©μ‹μ μ°¨μ΄λ”?

### Spring Bean
κΈ°μ΅΄μ Spring MVCλ” xmlμ„ ν™μ©ν•μ—¬ beanμ„ λ“±λ΅ν–λ‹¤. ν•μ§€λ§ ν”„λ΅μ νΈ κ·λ¨κ°€ μ»¤μ§€λ©΄μ„
μ–΄λ…Έν…μ΄μ…μ„ ν™μ©ν•μ—¬ Beanμ„ λ“±λ΅ν•λ” λ°©λ²•μ΄ μƒκ²¨λ‚¬λ‹¤.

> Springμ—μ„λ” Spring DI Containerμ— μν•΄ κ΄€λ¦¬λλ” POJOλ¥Ό Beanμ΄λΌκ³  λ¶€λ¥΄λ©°, μ΄λ¬ν• Beanλ“¤μ€
> Springμ„ κµ¬μ„±ν•λ” ν•µμ‹¬μ”μ†μ΄λ‹¤.

λΉλ“±λ΅
```java
@Configuration
public class ResourceConfig {
    
    @Bean
    public Encrypt passwordEncrypt() {
        return new PasswordEncrypt();
    }
}
```
λΉμ„ λ“±λ΅ν•  λ• λ©”μ„λ“ μ΄λ¦„μΌλ΅ λΉ μ΄λ¦„μ΄ κ²°μ •λλ‹¤. μ¤‘λ³µλ λΉ μ΄λ¦„μ΄ μ΅΄μ¬ν•μ§€ μ•λ„λ΅ μ£Όμ

`@Bean` μ„ μ‚¬μ©ν•λ” ν΄λμ¤μ—λ” λ°λ“μ‹ `@Configuration` μ–΄λ…Έν…μ΄μ…μ„ ν™μ©ν•μ—¬ ν•΄λ‹Ή ν΄λμ¤μ—μ„ Bean
μ„ λ“±λ΅ν•κ³ μ ν•¨μ„ λ…μ‹ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤. μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅λ λ‹¤λ¥Έ ν΄λμ¤ μ•μ—μ„ `@Bean` μΌλ΅ μ§μ ‘ λΉμ„
λ“±λ΅ν•΄μ£Όλ” κ²ƒλ„ λ™μ‘ν•μ§€ μ•λ”λ‹¤. `@Configuration` μ•μ—μ„ `@Bean` μ„ μ‚¬μ©ν•΄μ•Ό μ‹±κΈ€ν†¤μ„ λ³΄μ¥λ°›μ„ μ μμΌλ―€λ΅
`@Bean` μ–΄λ…Έν…μ΄μ…μ€ λ°λ“μ‹ `@Configuration` κ³Ό ν•¨κ» μ‚¬μ©ν•λ‹¤.

`@Bean` μ–΄λ…Έν…μ΄μ…μ κ²½μ°λ” μλ™μΌλ΅ λΉμ„ μ§μ ‘ λ“±λ΅ν•΄μ¤μ•Όλ§ ν•λ” μƒν™©
1. κ°λ°μκ°€ μ§μ ‘ μ μ–΄κ°€ λ¶κ°€λ¥ν• λΌμ΄λΈλ¬λ¦¬λ¥Ό ν™μ©ν•  λ•
2. μ• ν”λ¦¬μΌ€μ΄μ… μ „ λ²”μ„μ μΌλ΅ μ‚¬μ©λλ” ν΄λμ¤λ¥Ό λ“±λ΅ν•  λ•
3. λ‹¤ν•μ„±μ„ ν™μ©ν•μ—¬ μ—¬λ¬ κµ¬ν„μ²΄λ¥Ό λ“±λ΅ν•΄μ£Όμ–΄μ•Ό ν•  λ•

`@Component` :
λΉ μ–΄λ…Έν…μ΄μ…μΌλ΅ μ§μ ‘ λΉμ„ λ“±λ΅ν•λ” μ‘μ—…μ€ λΉμΌλ΅ λ“±λ΅ν•λ” ν΄λμ¤κ°€ λ§μ•„μ§μλ΅ μƒλ‹Ήν λ§μ€
μ‹κ°„μ΄ λ“¤κ³ , μƒμ‚°λ ¥ μ €ν•λ¥Ό μ•ΌκΈ°ν•λ‹¤. κ·Έλμ„ μ¤ν”„λ§μ—μ„λ” νΉμ • μ–΄λ…Έν…μ΄μ…μ΄ μλ” ν΄λμ¤λ¥Ό
μ°Ύμ•„μ„ λΉμΌλ΅ λ“±λ΅ν•΄μ£Όλ” μ»΄ν¬λ„νΈ μ¤μΊ” κΈ°λ¥μ„ μ κ³µν•λ‹¤.

μ¤ν”„λ§μ€ μ»΄ν¬λ„νΈ μ¤μΊ”μ„ μ‚¬μ©ν•΄μ„ `@Component` μ–΄λ…Έν…μ΄μ…μ΄ μλ” ν΄λμ¤λ“¤μ„ μ°Ύμ•„μ„ μλ™μΌλ΅ λΉ
λ“±λ΅μ„ ν•΄μ¤€λ‹¤. κ·Έλμ„ μ°λ¦¬κ°€ μ§μ ‘ κ°λ°ν• ν΄λμ¤λ¥Ό λΉμΌλ΅ νΈλ¦¬ν•κ² λ“±λ΅ν•κ³ μ ν•λ” κ²½μ°μ—λ”
`@Component` μ–΄λ…Έν…μ΄μ…μ„ ν™μ©ν•λ©΄ λλ‹¤.


## κ¶μ¥μ‚¬ν•­
μ¤ν”„λ§μ€ κΈ°λ³Έμ μΌλ΅ μ»΄ν¬λ„νΈ μ¤μΊ”μ„ μ΄μ©ν• μλ™ λΉ λ“±λ΅ λ°©μ‹μ„ κ¶μ¥ν•λ‹¤. λν• μ§μ ‘ κ°λ°ν•
ν΄λμ¤λ” `@Component` λ¥Ό ν†µν•΄ ν•΄λ‹Ή ν΄λμ¤λ¥Ό λΉμΌλ΅ λ“±λ΅ν•¨μ„ λ…Έμ¶ν•λ” κ²ƒμ΄ μΆ‹λ‹¤. μ™λƒν•λ©΄ ν•΄λ‹Ή
ν΄λμ¤μ— μλ” `@Component` λ§ λ³΄λ©΄ ν•΄λ‹Ή λΉμ΄ λ“±λ΅λλ„λ΅ μ μ„¤μ •λμ—λ”μ§€λ¥Ό λ°”λ΅
νμ•…ν•  μ μκΈ° λ•λ¬Έμ΄λ‹¤. `@Bean` μ„ μ΄μ©ν•λ©΄ λΉμΌλ΅ λ“±λ΅ν•λ” μ‘μ—…λ„ λ²κ±°λ΅μ°λ©° λΉμ΄ λ“±λ΅λμ—λ”μ§€
νμ•…ν•λ” κ³Όμ •λ„ λ²κ±°λ¬μ›μ§ μ μλ‹¤.

# μ •λ¦¬
`@Bean`, `@Configuration`
- μλ™μΌλ΅ μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— λΉμ„ λ“±λ΅ν•λ” λ°©λ²•
- κ°λ°μκ°€ μ§μ ‘ μ μ–΄κ°€ λ¶κ°€λ¥ν• λΌμ΄λΈλ¬λ¦¬λ¥Ό λΉμΌλ΅ λ“±λ΅ν•  λ• λ¶κ°€ν”Όν•κ² μ‚¬μ©
- μ μ§€λ³΄μμ„±μ„ λ†’μ΄κΈ° μ„ν•΄ μ• ν”λ¦¬μΌ€μ΄μ… μ „λ²”μ„μ μΌλ΅ μ‚¬μ©λλ” ν΄λμ¤λ‚ λ‹¤ν•μ„±μ„ ν™μ©ν•μ—¬ μ—¬λ¬ κµ¬ν„μ²΄λ¥Ό λΉμΌλ΅ λ“±λ΅ν•  λ•
- 1κ° μ΄μƒμ @Beanμ„ μ κ³µν•λ” ν΄λμ¤μ κ²½μ° λ°λ“μ‹ @Configurationμ„ λ…μ‹ν•΄ μ£Όμ–΄μ•Ό μ‹±κΈ€ν†¤μ΄ λ³΄μ¥λ¨

`@Component`
- μλ™μΌλ΅ μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— λΉμ„ λ“±λ΅ν•λ” λ°©λ²•
- μ¤ν”„λ§μ μ»΄ν¬λ„νΈ μ¤μΊ” κΈ°λ¥μ΄ @Component μ–΄λ…Έν…μ΄μ…μ΄ μλ” ν΄λμ¤λ¥Ό μλ™μΌλ΅ μ°Ύμ•„μ„ λΉμΌλ΅ λ“±λ΅
- λ€λ¶€λ¶„ @Component μλ™ λ“±λ΅ λ°©μ‹μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ μΆ‹μ

## UserRepository ν…μ¤νΈ μ§„ν–‰ν•λ©΄μ„ μ μ €μ λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™”ν•΄μ£Όκ³  μ‹¶μ—λ‹¤.

λ‚΄κ°€ λΉμΌλ΅ λ“±λ΅ν•΄λ‘” `PasswordEncryptor` μ»΄ν¬λ„νΈλ” μ¤ν”„λ§μ—μ„ κ΄€λ¦¬ν•λ” λΉμ΄λ‹¤.
ν…μ¤νΈ ν•  λ• `Jpa` κ΄€λ ¨ μ»΄ν¬λ„νΈλ§ λ΅λ“ν•κΈ° λ•λ¬Έμ— μ¤ν”„λ§λ¶€νΈμ λΉμ„ λ»κ°€μ Έμ™€μ„ μ—λ¬κ°€ λ°μƒν–λ‹¤.

μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ…μ‹μ μΌλ΅ λΉμ„ κ°€μ§€κ³ μ¬ μ μλ” λ°©λ²•μ€ λ¬΄μ—‡μΈκ°€?

1. `@Import` λ΅ λ…μ‹μ  λ“±λ΅
2. `@TestConfiguration` μ‚¬μ©

```java
@DataJpaTest
@Import({JpaConfig.class, PasswordEncrypt.class})
@AutoConfigureTestDatabase(connection = EmbeddedDatabaseConnection.NONE)
```

```java
@Configuration
public class TestConfig{
    
    @Bean
    public Encryptor passwordEncryptor() {
        return new PasswordEncryptor();
    }
}

@Import({JpaConfig.class, TestConfig.class})
class test {
    //...
}
```

λ§μ•½ κ°€μ§€κ³  μ™€μ•Όν•  μ»΄ν¬λ„νΈκ°€ λ§λ‹¤λ©΄ ν…μ¤νΈλ¥Ό μ„ν• config κ°μ²΄λ¥Ό λ§λ“¤μ–΄μ„ ν•κΊΌλ²μ— κ°€μ§€κ³ μ¨λ‹¤.
μ§€κΈμ€ ν•λ‚λ§ ν•„μ”ν•κΈ° λ•λ¬Έμ— μΌλ‹¨ μ •ν™•ν• μ»΄ν¬λ„νΈλ¥Ό λ…μ‹μ μΌλ΅ import ν•΄μ£Όμ.
