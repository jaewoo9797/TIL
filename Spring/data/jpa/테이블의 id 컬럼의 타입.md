# BIGINT - 엔티티 pk 값의 속성

데이터베이스에 테이블을 저장할 때 행을 식별하기 위한 pk 값을 부여합니다. 
기본키(Primary key)는 시스템이 한 테이블에 있는 Row가 다른 Row와 구별되는 무언가를 가져야 하므로 이 역할을 PK값이 수행할 수 있습니다. 기본키는 한 Row마다 유일해야 하며 NULL이 될 수 없어야 합니다.

pk 컬럼의 속성은 `BIGINT` 로 설정하여 엔티티를 만든다. `BIGINT` 란 무엇인가요?

## ✅ BITINT
**MYSQL DOCUMENT**
|TYPE|Storage(Bytes)|Max Value Unsigned|
|---|---|---|
|TINYINT|1|255|
|SMALLINT|2|65535|
|MEDIUMINT|3|16777215|
|INT|4|4294967295|
|BIGINT|8|2<sup>64</sup>-1

공식문서를 살펴보면 `BIGINT`의 바이트 크기는 8BYTE 라는 것을 알 수 있다. 이는 매우 큰 값으로 네트워크 주소에서도 과거에는 2<sup>32</sup>(IPv4) 의 크기로 관리되다가, 2<sup>64</sup>(IPv6) 크기로 확장되었다. 이처럼 매우 큰 값을 저장할 수 있는 속성으로 대규모 프로젝트를 진행함에 있어 pk 값의 속성은 `BIGINT`를 사용하여 관리한다. 

## ✅ 내 프로젝트에 적용
대규모 프로젝트가 아닌 작은 프로젝트를 진행하는데 있어서 `BIGINT`를 무조건 사용해야하는가요? 

작은 프로젝트에 어떤 속성을 선택해야하는지에는 mysql의 메모리 용량, 서버 저장 공간, 쿼리 속도 등을 고려해야 합니다. 

숫자형 데이터 유형은 고정된 양의 공간을 차지합니다. 이는 작은 값이 들어가도 큰 값이 들어가도 고정된 양만큼의 공간을 차지합니다. 이해를 돕기위해 반대되는 속성으로 가변형 데이터인 `varchar` 가 있습니다. `varchar` 데이터 속성은 가변형 데이터 속성으로 저장되는 데이터의 값의 길이에 따라서 저장되는 공간이 바뀝니다. `BIGINT` 속성을 사용하게된다면 8바이트 만큼의 고정된 공간을 차지하게 됩니다.    

`INT` 형이 `BIGINT` 형에 비해 성능이 떨어지며 디스크 용량을 많이 차지합니다. 수 십억개의 데이터를 가지지 않을 것이라면 속도 등 효율성 측면에서 `BIGINT` 대신 `INT`형을 사용하는 것을 권장합니다. 

*참조* : [*stackoverflow*](https://stackoverflow.com/questions/34508152/memory-allocation-in-mysql-datatypes)

## 분산된 환경에서의 pk
지금까지 숫자형 속성에 대해서 살펴보았습니다. DB에서 자동으로 생성해주는 pk 값은 한가지 생각해야 하는 부분이 있어서 잠시 살펴보겠습니다.

JPA와 DB에서 프로젝트를 설계할 때 간단하게 `pk` 값을 설정할 수 있도록 `Auto Increment` 설정을 통해서 자동적으로 증가하는 설정을 해주었습니다. 요즘 설계에서는 MSA, 분산환경을 통해서 애플리케이션을 구축하는 것이 자리잡고 있습니다. 이런 환경에서 자동으로 생성해주는 값은 여러 데이터베이스가 있는 상황에서는 별다른 동기화가 되어있지 않다면 `Duplicate Key`가 발생할 확률이 높고 이는 정합성에 문제가 생길 수 있습니다. 또한, 키를 예측하기 쉬워 보안 문제가 생길 수 있습니다.

이러한 제약을 생각하게 된다면, UUID(Univerally Unique ID) 를 사용하는 것이 좋습니다. 이는 128비트 데이터로 충돌 가능성이 굉장히 낮은 값입니다. 기존 INT에 비해서 메모리 사용량이 많고 네트워크를 통해 데이터를 insert 하는 시간이 보다 더 걸립니다.

[UUID](/sprint-mission//mission01/uuid/✅UUID.md)